# BrickGame Tetris

Компактная реализация классического «Тетриса» на языке C с выводом в терминал через `ncurses`. Проект основан на конечном автомате состояний, сохраняет лучший результат между сессиями и включает набор модульных тестов.

## Возможности
- Цветной CLI-интерфейс с отображением следующей фигуры и панели статистики.
- Семь стандартных фигур, мгновенное «уронение» вниз, накапливаемая сложность и ускорение уровня.
- Пауза и досрочное завершение игры, поддержка сохранения лучшего счета в `highscore.txt`.
- Модульная архитектура: игровая логика отделена от визуализации и входа.
- Набор unit-тестов на базе `check`, генерация отчета покрытия и документации через Doxygen.

## Зависимости
- GCC (или совместимый компилятор C11)
- `make`
- `libncursesw` (широкие символы)
- `check` (для тестов)
- `lcov` и `genhtml` (для отчета покрытия)
- `valgrind` (для проверки утечек)
- `clang-format` (для цели `make format`)
- `doxygen` + графические утилиты (для цели `make dvi`)

### Установка зависимостей (Ubuntu / Debian)
```sh
sudo apt update
sudo apt install build-essential libncursesw5-dev check lcov valgrind clang-format doxygen graphviz
```

## Сборка и запуск
```sh
cd src
make          # собирает библиотеку и исполняемый файл
../build/tetris
```
После сборки исполняемый файл доступен также из корня репозитория по пути `./build/tetris`.

## Управление
| Клавиша | Действие |
| --- | --- |
| `Enter` | старт новой игры из состояния ожидания |
| `←` / `→` | перемещение фигуры влево / вправо |
| `↑` | поворот фигуры по часовой стрелке |
| `↓` | мгновенное опускание фигуры до соприкосновения |
| `P` | пауза / продолжить |
| `Q` | выход и сохранение рекорда |

## Структура проекта
- `src/brickgame/tetris/` — основная логика игры, конечный автомат, система очков и работы с рекордом.
- `src/gui/cli/` — вывод на терминал с помощью `ncurses`, отрисовка поля и панели информации.
- `src/cmd/` — точка входа приложения и главный цикл.
- `src/tests/` — модульные тесты библиотеки `brickgame`.
- `src/Makefile` — сценарии сборки, тестирования и развёртывания.
- `src/highscore.txt` — сохраняемый лучший результат.
- `src/fsm_diagram.svg` — схема конечного автомата игры.
- `src/Doxyfile` — конфигурация генерации документации.

## Тестирование и контроль качества
- `make test` — компиляция и запуск unit-тестов (использует библиотеку `check`).
- `make gcov_report` — запуск тестов с покрытием и генерация HTML-отчета в `src/report/`.
- `make leaks` — проверка на утечки памяти через Valgrind (потребует доступ к `valgrind`).
- `make format` — проверка и автоматическое применение `clang-format` для `.c`/`.h`.

## Документация
Команда `make dvi` собирает HTML-документацию Doxygen на основе `Doxyfile`. Отчеты появляются в `src/doxygen/html/` и автоматически открываются стандартным браузером (при поддержке вашей системы).

## Сохранение рекорда
Лучший результат игры хранится в `src/highscore.txt`. Файл создается и обновляется автоматически при завершении сессии. Для сброса рекорда достаточно удалить файл перед следующим запуском.

